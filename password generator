

import secrets
import string
import tkinter as tk
from tkinter import ttk, messagebox

def build_charset(lower, upper, digits, symbols):
    parts = []
    if lower:
        parts.append(string.ascii_lowercase)
    if upper:
        parts.append(string.ascii_uppercase)
    if digits:
        parts.append(string.digits)
    if symbols:
        parts.append("!@#$%^&*()-_=+[]{};:,.<>?/|")
    if not parts:
        return ""
    return "".join(parts)

def generate_password(length, charset):
    return ''.join(secrets.choice(charset) for _ in range(length))

def strength_label(pw):
    score = 0
    if len(pw) >= 8: score += 1
    if len(pw) >= 12: score += 1
    if any(c.islower() for c in pw): score += 1
    if any(c.isupper() for c in pw): score += 1
    if any(c.isdigit() for c in pw): score += 1
    if any(c in "!@#$%^&*()-_=+[]{};:,.<>?/|" for c in pw): score += 1

    if score <= 2:
        return "Very weak"
    elif score <= 3:
        return "Weak"
    elif score <= 4:
        return "Moderate"
    elif score <= 5:
        return "Strong"
    else:
        return "Very strong"

def on_generate():
    try:
        length = int(length_var.get())
    except ValueError:
        messagebox.showerror("Invalid", "Length must be an integer")
        return
    ch = build_charset(lower_var.get(), upper_var.get(), digits_var.get(), symbols_var.get())
    if not ch:
        messagebox.showwarning("No character set", "Select at least one character type.")
        return
    pw = generate_password(length, ch)
    result_var.set(pw)
    strength_var.set(strength_label(pw))
    # copy to clipboard
    root.clipboard_clear()
    root.clipboard_append(pw)

def on_save():
    pw = result_var.get()
    if not pw:
        messagebox.showinfo("Nothing", "Generate a password first.")
        return
    fname = filename_var.get().strip()
    if not fname:
        messagebox.showerror("Filename", "Enter a filename to save into.")
        return
    try:
        with open(fname, "a", encoding="utf-8") as f:
            f.write(pw + "\n")
        messagebox.showinfo("Saved", f"Saved password to {fname}")
    except Exception as e:
        messagebox.showerror("Error", str(e))

# Build UI
root = tk.Tk()
root.title("Password Generator")

frm = ttk.Frame(root, padding=12)
frm.grid(row=0, column=0, sticky="nsew")

length_var = tk.StringVar(value="16")
lower_var = tk.BooleanVar(value=True)
upper_var = tk.BooleanVar(value=True)
digits_var = tk.BooleanVar(value=True)
symbols_var = tk.BooleanVar(value=True)
result_var = tk.StringVar()
strength_var = tk.StringVar(value="")

filename_var = tk.StringVar(value="passwords.txt")

ttk.Label(frm, text="Length:").grid(row=0, column=0, sticky="w")
ttk.Entry(frm, width=6, textvariable=length_var).grid(row=0, column=1, sticky="w")

ttk.Checkbutton(frm, text="lowercase", variable=lower_var).grid(row=1, column=0, sticky="w")
ttk.Checkbutton(frm, text="UPPERCASE", variable=upper_var).grid(row=1, column=1, sticky="w")
ttk.Checkbutton(frm, text="digits", variable=digits_var).grid(row=2, column=0, sticky="w")
ttk.Checkbutton(frm, text="symbols", variable=symbols_var).grid(row=2, column=1, sticky="w")

ttk.Button(frm, text="Generate", command=on_generate).grid(row=3, column=0, pady=8)
ttk.Label(frm, text="Strength:").grid(row=3, column=1, sticky="w")
ttk.Label(frm, textvariable=strength_var).grid(row=3, column=2, sticky="w")

ttk.Entry(frm, width=40, textvariable=result_var).grid(row=4, column=0, columnspan=3, pady=6)
ttk.Label(frm, text="(Copied to clipboard automatically)").grid(row=5, column=0, columnspan=3, sticky="w")

ttk.Label(frm, text="Save to file:").grid(row=6, column=0, sticky="w")
ttk.Entry(frm, width=25, textvariable=filename_var).grid(row=6, column=1, sticky="w")
ttk.Button(frm, text="Save", command=on_save).grid(row=6, column=2, sticky="w")

root.mainloop()
